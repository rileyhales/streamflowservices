{% extends "streamflowservices/base.html" %}

{% load staticfiles %}
{% load tethys_gizmos %}


{% block header_buttons %}
  <div class="header-button glyphicon-button" data-toggle="tooltip" data-placement="bottom" title="View Chart">
    <a data-toggle="modal" data-target="#chart_modal"><span class="glyphicon glyphicon-globe"></span></a>
  </div>
  <div class="header-button glyphicon-button" data-toggle="tooltip" data-placement="bottom" title="Search for River">
    <a data-toggle="modal" data-target="#search_modal"><span class="glyphicon glyphicon-search"></span></a>
  </div>
{% endblock %}


{% block app_content %}
  <div id="map" class="map" watersheds="{{ watersheds_list }}" watersheds_hydroshare_ids="{{ watersheds_hydroshare_ids }}"></div>
{% endblock %}

{% block after_app_content %}
<!-- Chart Modal -->
<div class="modal fade" id="chart_modal" tabindex="-1" role="dialog" aria-labelledby="about-modal-label">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <div class="row">
          <h2 style="text-align: center">Streamflow Results <span id="request-status" class="load-status"/></h2>
        </div>
      </div>

      <div class="modal-body">
        <!-- Nav tabs -->
        <ul class="nav nav-tabs" role="tablist">
          <li role="presentation" class="active"><a id="forecast_tab_link" href="#forecast_tab" aria-controls="forecast_tab" role="tab" data-toggle="tab">Forecast</a></li>
          <li role="presentation"><a id="historical_tab_link" href="#historical" aria-controls="historical" role="tab" data-toggle="tab">Historical</a></li>
          <li role="presentation"><a id="flow_duration_tab_link" href="#flow_duration" aria-controls="flow_duration" role="tab" data-toggle="tab">Flow-Duration</a></li>
          <li role="presentation"><a id="seasonal_avg_tab_link" href="#seasonal_avg" aria-controls="seasonal_avg" role="tab" data-toggle="tab">Seasonal Average</a></li>
          <li role="presentation"><a href="#download" aria-controls="download" role="tab" data-toggle="tab">Download</a></li>
        </ul>

        <!-- Tab panes -->
        <div class="tab-content">
          <div role="tabpanel" class="tab-pane active" id="forecast_tab">
            <div class="panel panel-default">
              <div class="panel-body">
                <div id="dates" class="hidden form-group" style="padding: 30px 30px 20px 0">
                  <select id="datesSelect" class="form-control"></select>
                </div>
                  <div id="forecast-chart"></div>
                  <div id="forecast-table"></div>
              </div>
            </div>
          </div> <!-- /.tab-pane -->

          <div role="tabpanel" class="tab-pane" id="historical">
            <div class="panel panel-default">
              <div id="historical-chart" class="panel-body"></div>
            </div>
          </div><!-- /.tab-pane -->

          <div role="tabpanel" class="tab-pane" id="flow_duration">
            <div class="panel panel-default">
              <div id='flowduration-chart' class="panel-body"></div>
            </div>
          </div><!-- /.tab-pane -->

          <div role="tabpanel" class="tab-pane" id="seasonal_avg">
            <div class="panel panel-default">
              <div id='seasonal-chart' class="panel-body"></div>
            </div>
          </div><!-- /.tab-pane -->

          <div role="tabpanel" class="tab-pane" id="download">
            <div class="panel panel-default">
              <div class="panel-body">
                <h6>Download Forecast Data</h6>
                <div id="download_forecast" class="btn-group long-term-select" role="group">
                  <a class="btn btn-success" role="button" id="download-forecast-btn" target="_blank">Download Forecast</a>
                </div>

                <h6>Download Historical (ERA Interim Simulation) Data</h6>
                <div id="download_interim" class="btn-group" role="group">
                  <a class="btn btn-info" role="button" id="download-historical-btn" target="_blank">Download Interim Data</a>
                </div>

                <h6>Download Seasonal Average Chart</h6>
                <div id="download_interim" class="btn-group" role="group">
                  <a class="btn btn-danger" role="button" id="download-seasonal-btn" target="_blank">Download Seasonal Average</a>
                </div>

              </div>
            </div>
          </div>

        </div>
      </div>
      <div id="info" class="hidden"></div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" id="resize_charts">Resize the Chart</button>
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block styles %}
  {{ block.super }}
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css">
  <link rel="stylesheet" href="{% static 'streamflowservices/css/hydroviewer.css' %}">
{% endblock %}

{% block scripts %}
  {{ block.super }}
  <script>
    let gsURL = "{{ gs_url }}";
    let endpoint = "{{ endpoint }}";
  </script>
  <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"></script>
  <script src="https://unpkg.com/esri-leaflet@2.2.3/dist/esri-leaflet.js"></script>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script type="text/javascript" src="{% static 'streamflowservices/js/hydroviewer.js' %}"></script>
{% endblock %}
